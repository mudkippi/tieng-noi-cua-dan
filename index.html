<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>L√†ng T√¢n Ph√∫c ‚Äî Ti·∫øng N√≥i c·ªßa D√¢n</title>
<style>
:root{--text:#f5f5f5;--accent:#ffeb99;}
html,body{height:100%;margin:0;background:#000;font-family:"Times New Roman",serif;color:var(--text);overflow:hidden}
#game{position:relative;width:100vw;height:100vh;overflow:hidden}
#background{position:absolute;top:0;left:0;width:100%;height:65vh;background-size:cover;background-position:center;transition:opacity .8s ease;opacity:1}
#background.fade{opacity:0}
#music-toggle{position:absolute;top:12px;right:12px;z-index:40;padding:8px 12px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:var(--text);border-radius:6px;cursor:pointer}
#voice-toggle {position: absolute;top: 50px; /* d∆∞·ªõi n√∫t nh·∫°c m·ªôt ch√∫t */right: 12px;z-index: 40;padding: 8px 12px;background: rgba(255,255,255,0.08);border: 1px solid rgba(255,255,255,0.12);color: var(--text);border-radius: 6px;cursor: pointer;
}

#choices{position:absolute;top:8%;left:0;right:0;z-index:30;display:flex;flex-direction:column;align-items:center;gap:10px;padding:0 16px}
.choice{width:72%;max-width:900px;background:rgba(0,0,0,0.8);border:1px solid rgba(255,255,255,0.3);color:#fff;padding:12px 18px;border-radius:8px;font-size:18px;cursor:pointer;text-align:center}
.choice:hover{background:rgba(0,0,0,0.95)}
#dialogue{position:fixed;left:0;right:0;bottom:0;height:35vh;background:#121212;padding:22px 36px;box-sizing:border-box;border-top:2px solid rgba(255,255,255,0.06);z-index:28;display:flex;flex-direction:column;gap:10px}
#speaker{color:var(--accent);font-weight:700}
#text{flex:1;overflow:auto;white-space:pre-line;line-height:1.5;font-size:20px;text-shadow:1px 1px 2px #000}
#next{display:none;margin-left:auto;padding:10px 16px;border-radius:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:#fff;cursor:pointer}
#start{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:50;padding:14px 28px;background:#fff;color:#000;border:none;border-radius:8px;font-size:18px;cursor:pointer}
#restart{display:none;position:absolute;left:50%;bottom:36%;transform:translateX(-50%);z-index:50;padding:12px 20px;background:#fff;color:#000;border:none;border-radius:8px;cursor:pointer}
@media (max-width:600px){ .choice{width:92%;font-size:16px} #text{font-size:18px} }
</style>
</head>
<body>
<div id="game">
  <div id="background"></div>
  <button id="music-toggle">T·∫Øt nh·∫°c</button>
  <button id="voice-toggle">T·∫Øt gi·ªçng tho·∫°i</button>

  <div id="choices" aria-hidden="true"></div>

  <div id="dialogue" aria-live="polite">
    <div id="speaker"></div>
    <div id="text"></div>
    <div style="display:flex;justify-content:flex-end;">
      <button id="next">Ti·∫øp t·ª•c</button>
    </div>
  </div>

  <button id="start">B·∫Øt ƒë·∫ßu tr√≤ ch∆°i</button>
  <button id="restart">Ch∆°i l·∫°i</button>
</div>

<audio id="bg-music" loop src="bg-music.mp3"></audio>
<audio id="click" src="click.mp3"></audio>
<audio id="voice"></audio>

<script>
// Game data: 15 scenes (1 intro, 2-11 ten situations, 12-15 endings)
const scenes = [
  // 1 Intro
  {
    bg: "images/scene1.jpg",
    voice: "voices/scene1.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `NƒÉm ·∫•y, sau nhi·ªÅu nƒÉm c·ªëng hi·∫øn cho th√¥n x√≥m, √¥ng Minh ƒë∆∞·ª£c d√¢n l√†ng T√¢n Ph√∫c t√≠n nhi·ªám b·∫ßu l√†m tr∆∞·ªüng th√¥n.
C√°i ch·ª©c ·∫•y nghe th√¨ l·ªõn, nh∆∞ng th·∫≠t ra ch·ªâ l√† ng∆∞·ªùi ‚Äúƒë·ª©ng gi·ªØa d√¢n v·ªõi tr√™n‚Äù, lo t·ª´ chuy·ªán c√°i c·∫ßu g·ªó t·ªõi t·ª´ng b√≥ r∆°m, h·∫°t g·∫°o.
√îng Minh mang trong l√≤ng m·ªôt ∆∞·ªõc nguy·ªán gi·∫£n d·ªã: ‚ÄúD√¢n m√¨nh ph·∫£i th·∫≠t s·ª± ƒë∆∞·ª£c n√≥i, ƒë∆∞·ª£c b√†n, ƒë∆∞·ª£c l√†m ch·ªß.‚Äù
Nh∆∞ng ƒë∆∞·ªùng ƒëi c·ªßa m·ªôt ng∆∞·ªùi l√£nh ƒë·∫°o gi·ªØa th·ªùi d√¢n ch·ªß c∆° s·ªü ch·∫≥ng bao gi·ªù b·∫±ng ph·∫≥ng.
L√≤ng d√¢n nh∆∞ n∆∞·ªõc, ch·ªâ c·∫ßn nghi√™ng m·ªôt ch√∫t l√† tr√†n b·ªù.
Li·ªáu √¥ng Minh c√≥ gi·ªØ ƒë∆∞·ª£c l√≤ng d√¢n, hay ƒë·ªÉ ni·ªÅm tin tan nh∆∞ kh√≥i chi·ªÅu tr√™n m√°i r·∫°?`
  },

  // 2 Con ƒë∆∞·ªùng qua x√≥m Tr·∫°i
  {
    bg: "images/scene2.jpg",
    voice: "voices/scene2.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Bu·ªïi h·ªçp l√†ng chi·ªÅu ·∫•y ƒë√¥ng h∆°n m·ªçi khi. M·ªçi ng∆∞·ªùi ng·ªìi chen ch√∫c, k·∫ª phe ƒë∆∞·ªùng m·ªõi, ng∆∞·ªùi th√¨ b·∫£o ‚Äúƒë∆∞·ªùng c≈© ƒëi ƒë∆∞·ª£c, t·ªôi g√¨ l√†m th√™m‚Äù.
√îng Minh nh√¨n quanh, th·∫•y c·ª• L·ª± ch·ªëng g·∫≠y, gi·ªçng kh√†n m√† r√†nh r·∫Ω:
‚ÄúN√≥i m√£i c≈©ng v·∫≠y, th√¥i ƒë·ªÉ √¥ng tr∆∞·ªüng quy·∫øt ƒëi cho r·ªìi!‚Äù
B·∫°n l√†m g√¨?`,
    choices: [
      {type:"A", label:"Cho d√¢n bi·ªÉu quy·∫øt, ƒëa s·ªë quy·∫øt th·∫ø n√†o th√¨ l√†m th·∫ø ƒë√≥.", result:"Cu·ªôc h·ªçp k√©o d√†i ƒë·∫øn t·∫≠n t·ªëi, ai c≈©ng n√≥i, ti·∫øng c√£i c·ªç vang c·∫£ ƒë√¨nh. Cu·ªëi c√πng, quy·∫øt ƒë∆∞·ª£c th√¨ mu·ªôn, th·ªùi gian l√£ng ph√≠.", resultVoice: "voices/result2A.mp3"},
      {type:"B", label:"Gi·∫£i th√≠ch l·ª£i √≠ch v√† v·∫≠n ƒë·ªông th√™m, nh∆∞ng v·∫´n t√¥n tr·ªçng quy·∫øt ƒë·ªãnh cu·ªëi c·ªßa d√¢n.", result:"Ng∆∞·ªùi nghe ng∆∞·ªùi hi·ªÉu, d√¢n b√†n r·ªìi ƒë·ªìng thu·∫≠n. S√°ng h√¥m sau, trai l√†ng ƒë√£ x·∫Øn qu·∫ßn mang cu·ªëc ra ƒë∆∞·ªùng, ti·∫øng c∆∞·ªùi xen trong ti·∫øng x·∫ªng.", resultVoice: "voices/result2B.mp3"},
      {type:"C", label:"Quy·∫øt l√†m lu√¥n, v√¨ n·∫øu ƒë·ªÉ d√¢n b√†n nhi·ªÅu s·∫Ω tr·ªÖ ti·∫øn ƒë·ªô.", result:"ƒê∆∞·ªùng m·ªü nhanh th·∫≠t, nh∆∞ng c√≥ v√†i ng∆∞·ªùi ng·ªìi qu√°n n∆∞·ªõc l·∫Øc ƒë·∫ßu: ‚ÄúD√¢n ch∆∞a k·ªãp b√†n, √¥ng Minh ƒë√£ t√≠nh h·∫øt r·ªìi.‚Äù", resultVoice: "voices/result2C.mp3"}
    ]
  },

  // 3 S·ªï chi ti√™u
  {
    bg: "images/scene3.jpg",
    voice: "voices/scene3.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `M·ªôt s√°ng, b√† H√≤a ‚Äì ch·ªß h·ªô bu√¥n th√≥c ‚Äì gh√© l√™n nh√† vƒÉn h√≥a, n√≥i nh·ªè:
‚Äú√îng cho t√¥i xem s·ªï chi ti√™u th√¥n, coi ti·ªÅn d√¢n ƒë√≥ng ƒë∆∞·ª£c d√πng ra sao.‚Äù
K·∫ø to√°n b√™n c·∫°nh chau m√†y, h·∫Øng gi·ªçng.
B·∫°n x·ª≠ tr√≠ th·∫ø n√†o?`,
    choices: [
      {type:"A", label:"Cho h·ªç xem to√†n b·ªô s·ªï, minh b·∫°ch r√µ r√†ng.", result:"D√¢n khen b·∫°n ngay th·∫≥ng, nh∆∞ng k·∫ø to√°n ƒë√¢m ra s·ª£, h√¥m sau r·ªâ tai nhau ‚Äú√¥ng Minh ph∆°i h·∫øt s·ªï ra cho thi√™n h·∫° coi, l·ªô c·∫£ chi trong n·ªôi b·ªô.‚Äù", resultVoice: "voices/result3A.mp3"},
      {type:"B", label:"Cho xem ph·∫ßn li√™n quan ƒë·∫øn d√¢n ƒë√≥ng g√≥p, ph·∫ßn kh√°c gi·ªØ n·ªôi b·ªô.", result:"M·ªçi vi·ªác y√™n, d√¢n v·ª´a l√≤ng, k·∫ø to√°n c≈©ng y√™n t√¢m. Nh∆∞ng ƒë√¢u ƒë√≥, v·∫´n c√≥ ti·∫øng n√≥i nh·ªè: ‚ÄúGi√° m√† ƒë∆∞·ª£c xem h·∫øt th√¨ hay.‚Äù", resultVoice: "voices/result3B.mp3"},
      {type:"C", label:"Gi·∫£i th√≠ch l√† s·∫Ω c√¥ng khai khi c√≥ b√°o c√°o t·ªïng k·∫øt, gi·ªù ch∆∞a ti·ªán.", result:"B√† H√≤a g·∫≠t ƒë·∫ßu, song tr√™n ƒë∆∞·ªùng v·ªÅ kh√¥ng n√≥i nƒÉng g√¨. M·∫•y b√† h√†ng x√≥m l·∫°i th√¨ th·∫ßm ‚Äúch·∫Øc s·ªï c√≥ ƒëi·ªÅu chi gi·∫•u.‚Äù", resultVoice: "voices/result3C.mp3"}
    ]
  },

  // 4 Ch·ªçn ng∆∞·ªùi ƒëi h·ªçp x√£
  {
    bg: "images/scene4.jpg",
    voice: "voices/scene4.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `X√£ g·ª≠i gi·∫•y m·ªùi: ‚ÄúTh√¥n c·ª≠ 2 ƒë·∫°i di·ªán nh√¢n d√¢n ƒëi d·ª± h·ªçp g√≥p √Ω quy ho·∫°ch ƒë·∫•t.‚Äù
√îng Minh c·∫ßm gi·∫•y, suy nghƒ© m√£i.`,
    choices: [
      {type:"C", label:"T·ª± ch·ªçn hai ng∆∞·ªùi m√¨nh tin c·∫≠y.", result:"Bu·ªïi h·ªçp tr√™n x√£ di·ªÖn ra su√¥n s·∫ª, ai n·∫•y ƒë·ªÅu khen th√¥n T√¢n Ph√∫c ph√°t bi·ªÉu c√≥ ch·ª´ng m·ª±c. Nh∆∞ng ·ªü l√†ng, v√†i ng∆∞·ªùi l·∫Øc ƒë·∫ßu: ‚ÄúL·∫°i ng∆∞·ªùi nh√† √¥ng Minh c·∫£ th√¥i.‚Äù", resultVoice: "voices/result4C.mp3"},
      {type:"A", label:"ƒê·ªÅ ngh·ªã d√¢n t·ª± ch·ªçn qua b·ªè phi·∫øu nhanh.", result:"L√†ng r·ªôn r√†ng, m·∫•t nhi·ªÅu th·ªùi gian, d√¢n v·ªó tay vang. ‚ÄúTh√¥n m√¨nh d√¢n ch·ªß th·∫≠t,‚Äù c√≥ ng∆∞·ªùi n√≥i.", resultVoice: "voices/result4A.mp3"},
      {type:"B", label:"G·ª£i √Ω danh s√°ch r·ªìi ƒë·ªÉ d√¢n ch·ªçn trong ƒë√≥.", result:"D√¢n th·ªëng nh·∫•t nhanh, v·ª´a c√≥ ng∆∞·ªùi ƒë·∫°i di·ªán, v·ª´a tr√°nh tranh c√£i. Kh√¥ng kh√≠ h·ªçp l√†ng vui v·∫ª, tr·∫≠t t·ª±.", resultVoice: "voices/result4B.mp3"}
    ]
  },

  // 5 √ù ki·∫øn v·ªÅ s√¢n b√≥ng
  {
    bg: "images/scene5.jpg",
    voice: "voices/scene5.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `M·ªôt h·ªô tr·∫ª trong th√¥n ƒë·ªÅ ngh·ªã khu ƒë·∫•t d·ª± ƒë·ªãnh l√†m s√¢n b√≥ng n√™n tr·ªìng rau s·∫°ch.
‚ÄúB·ªçn nh·ªè ch∆°i ho√†i, ƒë·∫•t h∆∞ h·∫øt. Tr·ªìng rau c√≤n b√°n ƒë∆∞·ª£c.‚Äù
B·∫°n x·ª≠ tr√≠ th·∫ø n√†o?`,
    choices:[
      {type:"A", label:"Cho th·ª≠ m√¥ h√¨nh rau s·∫°ch ·ªü g√≥c ƒë·∫•t.", result:"M·ªôt g√≥c rau xanh m·ªçc l√™n th·∫≠t, nh∆∞ng ch·∫≥ng bao l√¢u ng∆∞·ªùi kh√°c c≈©ng ƒë√≤i ph·∫ßn 'ƒë·∫•t th·ª≠' ri√™ng, r·ªëi nh∆∞ canh h·∫π.", resultVoice: "voices/result5A.mp3"},
      {type:"B", label:"Ghi nh·∫≠n √Ω ki·∫øn v√† ƒë∆∞a ra b√†n c√¥ng khai v·ªõi d√¢n.", result:"D√¢n h·ªçp, ai c≈©ng n√≥i ph·∫ßn m√¨nh. Cu·ªëi c√πng th·ªëng nh·∫•t gi·ªØ s√¢n b√≥ng, nh∆∞ng ch·ª´a g√≥c ƒë·∫•t nh·ªè cho m√¥ h√¨nh rau s·∫°ch. Ti·∫øng v·ªó tay vang nh∆∞ tr·ªëng h·ªôi.", resultVoice: "voices/result5B.mp3"},
      {type:"C", label:"Gi·∫£i th√≠ch s√¢n b√≥ng l√† nhu c·∫ßu chung, kh√≥ thay ƒë·ªïi.", result:"D√¢n im l·∫∑ng g·∫≠t ƒë·∫ßu, nh∆∞ng √°nh m·∫Øt v√†i ng∆∞·ªùi ƒë√£ ngu·ªôi d·∫ßn, ni·ªÅm tin c≈©ng th·∫ø.", resultVoice: "voices/result5C.mp3"}
    ]
  },

  // 6 C√¥ng tr√¨nh n∆∞·ªõc s·∫°ch (revised)
  {
    bg: "images/scene6.jpg",
    voice: "voices/scene6.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Gi·ªØa tr∆∞a oi ·∫£, b√† Ng·ªçc, ng∆∞·ªùi n·∫•u c∆°m cho th·ª£, th·ªü d√†i:
‚Äú√îng Minh ∆°i, d√¢n m√¨nh g√≥p c√¥ng g√≥p c·ªßa, m√† nghe n√≥i th·ª£ tr·ªôn xi mƒÉng √≠t h∆°n quy ƒë·ªãnh ƒë√≥.‚Äù  
B·∫°n ph·∫£n ·ª©ng ra sao?`,
    choices:[
      {type:"A", label:"Cho m·ªùi to√†n d√¢n c√πng ra c√¥ng tr√¨nh ki·ªÉm tra ngay, c√¥ng khai tr∆∞·ªõc m·ªçi ng∆∞·ªùi.", result:"D√¢n √πn √πn k√©o ƒë·∫øn, khi·∫øn th·ª£ ng·ª´ng tay, nh√† th·∫ßu h·ªët ho·∫£ng. Cu·ªëi c√πng x√°c minh ƒë∆∞·ª£c c√≥ thi·∫øu v·∫≠t t∆∞ th·∫≠t, nh∆∞ng kh√¥ng kh√≠ cƒÉng th·∫≥ng khi·∫øn m·ªçi vi·ªác ch·∫≠m tr·ªÖ, ai c≈©ng b√†n t√°n r·ªëi r·∫Øm.", resultVoice: "voices/result6A.mp3"},
      {type:"B", label:"G·ªçi nh√† th·∫ßu l√™n l√†m vi·ªác, y√™u c·∫ßu b√°o c√°o r√µ r√†ng r·ªìi c√¥ng khai k·∫øt qu·∫£ v·ªõi d√¢n.", result:"Nh√† th·∫ßu h∆°i l√∫ng t√∫ng nh∆∞ng ch·∫•p h√†nh, g·ª≠i b·∫£n gi·∫£i tr√¨nh ƒë·∫ßy ƒë·ªß. √îng Minh ƒëem k·∫øt qu·∫£ ra h·ªçp d√¢n c√¥ng khai, kh√¥ng kh√≠ y√™n l·∫°i, d√¢n g·∫≠t g√π: ‚ÄúR·ª©a m·ªõi l√† minh b·∫°ch.‚Äù", resultVoice: "voices/result6B.mp3"},
      {type:"C", label:"H·ªèi ri√™ng ng∆∞·ªùi ph·∫£n √°nh ƒë·ªÉ n·∫Øm t√¨nh h√¨nh, ch∆∞a v·ªôi l√†m l·ªõn.", result:"Tin ƒë·ªìn v·∫´n c·ª© lan, m·ªói ng∆∞·ªùi n√≥i m·ªôt ki·ªÉu. ƒê·∫øn l√∫c s·ª± vi·ªác r√µ r√†ng, d√¢n b·∫£o: ‚ÄúGi√° m√† tr∆∞·ªüng x·ª≠ s·ªõm th√¨ ƒë·ª° mang ti·∫øng.‚Äù", resultVoice: "voices/result6C.mp3"}
    ]
  },

  // 7 L·ªùi than c·ªßa ng∆∞·ªùi d√¢n
  {
    bg: "images/scene7.jpg",
    voice: "voices/scene7.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
     text: `M·ªôt t·ªëi ch·ªõm ƒë√¥ng, gi√≥ l√πa qua m√°i ng√≥i.
√îng C·∫£nh ‚Äì ng∆∞·ªùi t·ª´ng g√≥p nhi·ªÅu c√¥ng trong vi·ªác d·ª±ng nh√† vƒÉn h√≥a ‚Äì ƒë·ª©ng d·∫≠y, gi·ªçng kh√†n n·∫∑ng trƒ©u:
‚Äúƒê√≥ng g√≥p m√£i, m√† d√¢n m√¨nh v·∫´n ch∆∞a th·∫•y l·ª£i ƒë√¢u, √¥ng tr∆∞·ªüng ·∫°. Ti·ªÅn n∆∞·ªõc s·∫°ch, ƒë∆∞·ªùng l√†ng‚Ä¶ to√†n h·ª©a m√£i.‚Äù
Kh√¥ng kh√≠ l·∫∑ng ƒëi. M·ªçi √°nh m·∫Øt ƒë·ªï d·ªìn v·ªÅ ph√≠a b·∫°n.`,
  choices: [
    {type: "A", label: "H·ªçp m·ªü cho ai c≈©ng n√≥i h·∫øt √Ω.", result: "D√¢n tranh nhau ph√°t bi·ªÉu, ti·∫øng b√†n ra t√°n v√†o r·ªôn c·∫£ ƒë√¨nh. Cu·ªëi c√πng ch·∫≥ng ƒëi ƒë·∫øn ƒë√¢u.", resultVoice: "voices/result7A.mp3"},
    {type: "B", label: "T·ªï ch·ª©c m·ªôt bu·ªïi ƒë·ªëi tho·∫°i ri√™ng, m·ªùi √¥ng C·∫£nh v√† ƒë·∫°i di·ªán c√°c h·ªô t·ªõi ƒë·ªÉ c√πng n√≥i r√µ t·ª´ng vi·ªác, t·ª´ng kho·∫£n.", result: "Bu·ªïi ƒë·ªëi tho·∫°i di·ªÖn ra trong kh√¥ng kh√≠ ch√¢n t√¨nh. √îng C·∫£nh cu·ªëi bu·ªïi ƒë·ª©ng d·∫≠y b·∫Øt tay b·∫°n, c∆∞·ªùi hi·ªÅn: 'Th√¥i, t√¥i hi·ªÉu r·ªìi.' Ti·∫øng v·ªó tay vang kh·∫Øp s√¢n.", resultVoice: "voices/result7B.mp3"},
    {type: "C", label: "G·∫∑p ri√™ng √¥ng C·∫£nh ƒë·ªÉ gi·∫£i th√≠ch, d·ªó d√†nh cho y√™n chuy·ªán, tr√°nh l√†m to tr∆∞·ªõc d√¢n.", result: "√îng ngu√¥i ngoai, nh∆∞ng tin ƒë·ªìn l·∫°i lan: 'Tr∆∞·ªüng s·ª£ d√¢n h·ªèi n√™n l√°nh m·∫∑t.'", resultVoice: "voices/result7C.mp3"}
    ]
  },

  // 8 Chuy·ªán h·ªô ngh√®o
  {
    bg: "images/scene8.jpg",
    voice: "voices/scene8.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Hai h·ªô ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t nh·∫≠n h·ªó tr·ª£: nh√† √¥ng Ph√∫c ‚Äì ng∆∞·ªùi b·∫°n c≈© c·ªßa b·∫°n ‚Äì v√† b√† Li√™n ‚Äì m·∫π ƒë∆°n th√¢n nu√¥i ba ƒë·ª©a nh·ªè.
L√†ng b√†n t√°n, ‚Äúli·ªáu c√≥ thi√™n v·ªã?‚Äù`,
    choices:[
      {type:"A", label:"ƒê∆∞a danh s√°ch ra h·ªçp d√¢n bi·ªÉu quy·∫øt l·∫°i to√†n b·ªô.", result:"D√¢n tranh lu·∫≠n n·∫£y l·ª≠a, c√≥ ng∆∞·ªùi ƒë√≤i th√™m, c√≥ ng∆∞·ªùi ph·∫£n ƒë·ªëi. Cu·ªëi c√πng kh√¥ng ai vui tr·ªçn.", resultVoice: "voices/result8A.mp3"},
      {type:"B", label:"Tr√¨nh b√†y th√¥ng tin, l√Ω do d·∫´n ƒë·∫øn quy·∫øt ƒë·ªãnh tr∆∞·ªõc d√¢n.", result:"V·∫´n c√≥ tin ƒë·ªìn ƒë√≥ ƒë√¢y, nh∆∞ng ƒëa s·ªë d√¢n ƒë·ªÅu hi·ªÉu v√† tin t∆∞·ªüng.", resultVoice: "voices/result8B.mp3"},
      {type:"C", label:"Gi·ªØ nguy√™n danh s√°ch, b·∫°n tin v√†o quy·∫øt ƒë·ªãnh c·ªßa m√¨nh.", result:"D√¢n b√†n ra b√†n v√†o: 'C√≥ th√¢n m·ªõi c√≥ ph·∫ßn.'", resultVoice: "voices/result8C.mp3"}
    ]
  },

  // 9 Quy ∆∞·ªõc v·ªÅ r√°c th·∫£i
  {
    bg: "images/scene9.jpg",
    voice: "voices/scene9.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Trong bu·ªïi h·ªçp, b√† NƒÉm G·∫°o ƒë·ª©ng l√™n n√≥i:
‚ÄúC√°i kho·∫£n ph·∫°t v·ª©t r√°c b·ª´a b√£i g·∫Øt qu√°, b·ªè ƒëi cho d√¢n d·ªÖ th·ªü.‚Äù`,
    choices:[
      {type:"A", label:"ƒê∆∞a ra bi·ªÉu quy·∫øt, √Ω d√¢n th·∫ø n√†o th√¨ l√†m.", result:"Ai c≈©ng gi∆° tay, b·ªè ph·∫°t h·∫øt. M·ªôt tu·∫ßn sau, r√°c b·ªëc m√πi kh·∫Øp ƒë∆∞·ªùng l√†ng.", resultVoice: "voices/result9A.mp3"},
      {type:"B", label:"Gi·∫£i th√≠ch l·ª£i √≠ch m√¥i tr∆∞·ªùng r·ªìi gi·ªØ nguy√™n quy ƒë·ªãnh.", result:"D√¢n g·∫≠t g√π, v√†i ng∆∞·ªùi v·∫´n kh√≥ ch·ªãu, nh∆∞ng sau ƒë√≥, ƒë∆∞·ªùng l√†ng s·∫°ch bong.", resultVoice: "voices/result9B.mp3"},
      {type:"C", label:"ƒêi·ªÅu ch·ªânh m·ª©c ph·∫°t nh·∫π h∆°n, l√†m b·∫£n th·ª≠ nghi·ªám 3 th√°ng.", result:"D√¢n c∆∞·ªùi, nh∆∞ng l·∫°i l√©n x·∫£ nhi·ªÅu h∆°n. 'Th·ª≠ th√¥i m√†,' ai c≈©ng n√≥i.", resultVoice: "voices/result9C.mp3"}
    ]
  },

  // 10 L√° th∆∞ n·∫∑c danh
  {
    bg: "images/scene10.jpg",
    voice: "voices/scene10.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Trong h·ªôp g√≥p √Ω c√≥ l√° th∆∞ t·ªë c√°o anh B·∫£o, c√°n b·ªô th√¥n, ‚ÄúƒÇn ch·∫∑n ti·ªÅn c√¥ng tr√¨nh‚Äù`,
    choices:[
      {type:"A", label:"C√¥ng khai ki·ªÉm tra tr∆∞·ªõc d√¢n.", result:"D√¢n ·ªì l√™n, anh B·∫£o m·∫∑t c·∫Øt kh√¥ng c√≤n gi·ªçt m√°u. Sau h√≥a ra th∆∞ sai, ng∆∞·ªùi vi·∫øt gi·∫•u m·∫∑t. L√†ng x√¨ x√†o m√£i kh√¥ng d·ª©t.", resultVoice: "voices/result10A.mp3"},
      {type:"B", label:"Giao c·∫•p tr√™n x·ª≠ l√Ω k√≠n, sau ƒë√≥ th√¥ng b√°o k·∫øt qu·∫£ ƒëi·ªÅu tra cho d√¢n.", result:"D√¢n im l·∫∑ng l·∫Øng nghe, th·∫•y b·∫°n l√†m nghi√™m, ai n·∫•y th√™m k√≠nh n·ªÉ.", resultVoice: "voices/result10B.mp3"},
      {type:"C", label:"B√°c b·ªè th√¥ng tin t·ª´ l√° th∆∞.", result:"C√¢u chuy·ªán d·ª´ng l·∫°i nhanh, nh∆∞ng d√¢n th√¨ ƒë·ªìn: 'Tr∆∞·ªüng bao che ng∆∞·ªùi nh√†.'", resultVoice: "voices/result10C.mp3"}
    ]
  },

  // 11 T·ªïng k·∫øt cu·ªëi nƒÉm
  {
    bg: "images/scene11.jpg",
    voice: "voices/scene11.mp3",
    speaker: "T∆∞·ªùng thu·∫≠t vi√™n",
    text: `Cu·ªëi nƒÉm, b·∫°n c·∫ßn n·ªôp b√°o c√°o v·ªÅ c√¥ng t√°c d√¢n ch·ªß c∆° s·ªü.
ƒê√™m l·∫°nh, ƒë√®n d·∫ßu leo l√©t, gi·∫•y tr·∫Øng tr∆∞·ªõc m·∫∑t v·∫´n tr·ªëng tr∆°n.`,
    choices:[
      {type:"A", label:"B·∫°n vi·∫øt t√≠ch c·ª±c, d√¢n ƒë√£ l√†m h·∫øt s·ª©c.", result:"D√¢n th·∫•y vui, nh∆∞ng v√†i ng∆∞·ªùi th·∫Øc m·∫Øc 'sao b√°o c√°o to√†n m√†u h·ªìng?'", resultVoice: "voices/result11A.mp3"},
      {type:"B", label:"Cho d√¢n xem b·∫£n d·ª± th·∫£o ƒë·ªÉ l·∫•y √Ω ki·∫øn t·ª´ nhi·ªÅu g√≥c nh√¨n.", result:"D√¢n th·∫•y vui, g√≥p √Ω c·ªßa d√¢n ƒë∆∞·ª£c coi tr·ªçng.", resultVoice: "voices/result11B.mp3"},
      {type:"C", label:"T·ª± ho√†n th√†nh b√°o c√°o, ƒë√¢y l√† vi·ªác c·ªßa tr∆∞·ªüng th√¥n.", result:"B√°o c√°o tr√¥i ch·∫£y, nh∆∞ng d√¢n b·∫£o '√¥ng Minh d·∫°o n√†y xa d√¢n l·∫Øm.'", resultVoice: "voices/result11C.mp3"}
    ]
  },

  // 12 Ending 1 (best)
  {
    bg: "images/scene12.jpg",
    voice: "voices/scene12.mp3",
    speaker: "K·∫øt th√∫c",
    ending: `üåø ENDING 1 ‚Äì Th√¥n D√¢n Ch·ªß Ki·ªÉu M·∫´u (T·ªët nh·∫•t)

M√πa g·∫∑t nƒÉm ·∫•y, c√°nh ƒë·ªìng T√¢n Ph√∫c v√†ng r·ªô r·ª±c r·ª°, ti·∫øng c∆∞·ªùi c·ªßa d√¢n l√†ng lan kh·∫Øp c√°c n·∫ªo ƒë∆∞·ªùng. Ng∆∞·ªùi ng∆∞·ªùi ƒë·ªÅu b·∫£o: ‚ÄúNh·ªù √¥ng Minh m√† th√¥n ta n√™n c∆° ƒë·ªì th·∫ø n√†y.‚Äù

D√¢n ƒë∆∞·ª£c b√†n, d√¢n ƒë∆∞·ª£c l√†m, d√¢n ƒë∆∞·ª£c bi·∫øt, d√¢n ƒë∆∞·ª£c ki·ªÉm tra ‚Äî t·∫•t c·∫£ nh∆∞ l·ªùi B√°c d·∫°y, ch·∫≥ng sai m·ªôt ch·ªØ. M·ªói c√¥ng tr√¨nh ƒë·ªÅu c√≥ b√†n tay g√≥p s·ª©c, m·ªói quy·∫øt ƒë·ªãnh ƒë·ªÅu in d·∫•u l√≤ng ng∆∞·ªùi. Kh√¥ng ai b·ªã b·ªè l·∫°i sau, c≈©ng ch·∫≥ng ai b·ªã √©p bu·ªôc.

ƒê√™m cu·ªëi nƒÉm, √¥ng Minh ng·ªìi b√™n ƒë√®n d·∫ßu, nh√¨n quy·ªÉn s·ªï g√≥p √Ω d√†y c·ªôp. √îng m·ªâm c∆∞·ªùi: ‚ÄúD√¢n m√¨nh tin r·ªìi, v·∫≠y l√† ƒë·ªß.‚Äù

M·ªôt th√¥n nh·ªè, m√† l√≤ng ng∆∞·ªùi l·ªõn. C·ªù ƒë·ªè sao v√†ng ph·∫•p ph·ªõi, ni·ªÅm tin v·ªØng nh∆∞ tre ƒë·∫ßu l√†ng.`
  },

  // 13 Ending 2 (good)
  {
    bg: "images/scene13.jpg",
    voice: "voices/scene13.mp3",
    speaker: "K·∫øt th√∫c",
    ending: `üåæ ENDING 2 ‚Äì Th√¥n ·ªîn ƒê·ªãnh (G·∫ßn t·ªët nh·∫•t)

T√¢n Ph√∫c y√™n b√¨nh, d√¢n t√¨nh ƒëa ph·∫ßn thu·∫≠n h√≤a. ƒê∆∞·ªùng b√™ t√¥ng ƒë√£ c√≥, gi·∫øng s·∫°ch n∆∞·ªõc trong, l≈© tr·∫ª con v·∫´n ch·∫°y ch∆°i tr∆∞·ªõc ƒë√¨nh.

·∫§y nh∆∞ng trong v√†i bu·ªïi h·ªçp, v·∫´n c√≥ ti·∫øng x√¨ x√†o: ‚ÄúChuy·ªán n√†y h√¨nh nh∆∞ tr√™n quy·∫øt r·ªìi ƒë√≥‚Äù, hay ‚ÄúTh√¥i, d√¢n m√¨nh n√≥i c≈©ng th·∫ø th√¥i m√†.‚Äù

√îng Minh nghe, l√≤ng ch√πng xu·ªëng ƒë√¥i ch√∫t. √îng bi·∫øt m√¨nh ƒë√£ c·ªë, nh∆∞ng v·∫´n c√≤n nh·ªØng ƒëi·ªÅu ch∆∞a v·∫πn. D√¢n ch·ªß, √¥ng hi·ªÉu, ch·∫≥ng ph·∫£i ch·ªâ c√≥ h·ªçp h√†nh hay b√°o c√°o ‚Äî m√† l√† ni·ªÅm tin, ni·ªÅm tin ph·∫£i ƒë∆∞·ª£c nu√¥i b·∫±ng s·ª± th·∫≠t m·ªói ng√†y.

√îng ƒë·ª©ng nh√¨n l√° c·ªù bay trong gi√≥ s·ªõm, kh·∫Ω g·∫≠t ƒë·∫ßu: ‚ÄúNƒÉm t·ªõi, m√¨nh l√†m l·∫°i. D√¢n ch∆∞a tin h·∫øt, th√¨ m√¨nh ch∆∞a xong nhi·ªám v·ª•.‚Äù`
  },

  // 14 Ending 3 (too democratic)
  {
    bg: "images/scene14.jpg",
    voice: "voices/scene14.mp3",
    speaker: "K·∫øt th√∫c",
    ending: `ü™∂ ENDING 3 ‚Äì Th√¥n Qu√° D√¢n Ch·ªß, Thi·∫øu ƒê·ªãnh H∆∞·ªõng

·ªû T√¢n Ph√∫c, chuy·ªán g√¨ c≈©ng ƒë∆∞a ra h·ªçp, b√†n m√£i ch·∫≥ng ng√£ ng≈©. Ng∆∞·ªùi mu·ªën l√†m ƒë∆∞·ªùng, ng∆∞·ªùi l·∫°i mu·ªën gi·ªØ ru·ªông; ng∆∞·ªùi ƒë√≤i x√¢y s√¢n b√≥ng, ng∆∞·ªùi l·∫°i b·∫£o tr·ªìng rau s·∫°ch.

√îng Minh, v·ªën hi·ªÅn, nghe d√¢n l√† ch√≠nh ‚Äî nh∆∞ng cu·ªëi c√πng, d√¢n c≈©ng‚Ä¶ ch∆∞a bi·∫øt nghe ai. C√¥ng vi·ªác ng·ªïn ngang, d·ª± √°n dang d·ªü.

M·ªói bu·ªïi h·ªçp d√¢n, ai c≈©ng n√≥i, nh∆∞ng ch·∫≥ng ai ch·ªãu nghe. ƒê·∫øn l√∫c ·∫•y, √¥ng Minh m·ªõi th·∫•m l·ªùi c·ª• c√°n b·ªô gi√†:

‚ÄúD√¢n ch·ªß m√† kh√¥ng c√≥ ƒë·ªãnh h∆∞·ªõng, th√¨ nh∆∞ thuy·ªÅn gi·ªØa s√¥ng kh√¥ng ng∆∞·ªùi l√°i ‚Äî cu·ªëi c√πng c≈©ng ch·ªâ quay v√≤ng.‚Äù

T√¢n Ph√∫c v·∫´n c√≤n vui, nh∆∞ng ni·ªÅm tin ƒë√£ nh·∫°t. D√¢n b√†n nhi·ªÅu, m√† ch·∫≥ng ai ƒë∆∞·ª£c h∆∞·ªüng tr·ªçn.`
  },

  // 15 Ending 4 (authoritarian)
  {
    bg: "images/scene15.jpg",
    voice: "voices/scene15.mp3",
    speaker: "K·∫øt th√∫c",
    ending: `üåë ENDING 4 ‚Äì Th√¥n Quan Li√™u, L√≤ng D√¢n Xa C√°ch (X·∫•u nh·∫•t)

T√¢n Ph√∫c ch·∫≥ng c√≤n r·ªôn r√£ ti·∫øng c∆∞·ªùi nh∆∞ tr∆∞·ªõc. D√¢n l√†m m√† kh√¥ng hi·ªÉu, ƒë√≥ng g√≥p m√† kh√¥ng r√µ, k√™u m√† ch·∫≥ng ai nghe.

√îng Minh, v·ªën nghƒ© ‚Äúl√†m cho nhanh, ƒë·ªÉ d√¢n ƒë∆∞·ª£c h∆∞·ªüng s·ªõm‚Äù, n√†o ng·ªù c√†ng l√†m, d√¢n c√†ng xa. Ng∆∞·ªùi b·∫£o ‚Äú√¥ng ·∫•y ch·ªâ lo tr√™n‚Äù, k·∫ª n√≥i ‚Äú√Ω d√¢n ƒë√¢u c√≤n quan tr·ªçng‚Äù.

M·ªôt h√¥m, trong bu·ªïi h·ªçp cu·ªëi nƒÉm, ch·ªâ l√°c ƒë√°c v√†i ng∆∞·ªùi ƒë·∫øn. √îng Minh nh√¨n h√†ng gh·∫ø tr·ªëng, ng·ªçn ƒë√®n d·∫ßu ch·∫≠p ch·ªùn h·∫Øt b√≥ng l√™n v√°ch.

‚ÄúM√¨nh sai ·ªü ƒë√¢u r·ªìi‚Ä¶‚Äù ‚Äî √¥ng kh·∫Ω n√≥i.

D√¢n ch·ªß m·∫•t ƒëi, ch·∫≥ng v√¨ ai kh√°c, m√† v√¨ ng∆∞·ªùi c·∫ßm l√°i qu√™n r·∫±ng: d√¢n l√† g·ªëc.`
  }
];

// State
let idx = 0; // current scene index in scenes array
let A = 0, B = 0, C = 0;
let started = false;

const bgEl = document.getElementById("background");
const speakerEl = document.getElementById("speaker");
const textEl = document.getElementById("text");
const choicesEl = document.getElementById("choices");
const nextBtn = document.getElementById("next");
const startBtn = document.getElementById("start");
const restartBtn = document.getElementById("restart");
const musicToggle = document.getElementById("music-toggle");
const bgMusic = document.getElementById("bg-music");
const clickSnd = document.getElementById("click");
const voice = document.getElementById("voice");
const voiceToggle = document.getElementById("voice-toggle");
let voiceEnabled = true;
let voiceFolder = "voices/"; // m·∫∑c ƒë·ªãnh folder gi·ªçng

// Helpers
function setBackground(path) {
  bgEl.classList.add("fade");
  setTimeout(()=> {
    bgEl.style.backgroundImage = `url('${path}')`;
    bgEl.classList.remove("fade");
  }, 300);
}

function playVoice(path) {
  if (!started || !voiceEnabled || !path) return;
  voice.pause();
  if (!voiceEnabled) return; // n·∫øu t·∫Øt voice th√¨ th√¥i
if (path) {
  const file = path.split("/").pop(); // l·∫•y t√™n file
  voice.src = voiceFolder + file;     // d√πng folder hi·ªán t·∫°i
}

  voice.currentTime = 0;
  voice.play().catch(()=>{ /* autoplay may be blocked until user interacts */ });
}

function playClick() {
  clickSnd.currentTime = 0;
  clickSnd.play().catch(()=>{});
}

function clearChoices() {
  choicesEl.innerHTML = "";
  choicesEl.setAttribute("aria-hidden","true");
}

function showChoices(arr) {
  clearChoices();
  choicesEl.setAttribute("aria-hidden","false");
  const shuffled = [...arr].sort(() => Math.random() - 0.5);
  shuffled.forEach(opt => {
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = opt.label;
    btn.onclick = () => {
      playClick();
      // count
      if (opt.type === "A") A++;
      if (opt.type === "B") B++;
      if (opt.type === "C") C++;
      // show result
      showResult(opt.result, opt.resultVoice);
    };
    choicesEl.appendChild(btn);
  });
}

// Typewriter
let typerTimeout;
function typeText(full, cb) {
  textEl.innerHTML = "";
  let i = 0;
  if (typerTimeout) clearInterval(typerTimeout);
  typerTimeout = setInterval(()=> {
    textEl.innerHTML += full.charAt(i);
    i++;
    if (i > full.length) {
      clearInterval(typerTimeout);
      typerTimeout = null;
      if (cb) cb();
    }
  }, 18);
}

// Show scene
function showScene() {
  const s = scenes[idx];
  setBackground(s.bg || "images/scene1.jpg");
  speakerEl.textContent = s.speaker || "";
  // play voice if present
  playVoice(s.voice);

  // If it's an ending
  if (s.ending) {
    clearChoices();
    nextBtn.style.display = "none";
    typeText(s.ending, () => {
      restartBtn.style.display = "block";
      // stop voice if any after reading or let it play
    });
    return;
  }

  // Normal scene with text and maybe choices
  typeText(s.text, () => {
    if (s.choices && s.choices.length) {
      // show choices in order: A (‚ö™), B (‚úÖ), C (‚ùå)
      showChoices(s.choices);
      nextBtn.style.display = "none";
    } else {
      // If no choices then show continue button
      clearChoices();
      nextBtn.style.display = "inline-block";
    }
  });
}

// Show result (after choosing)
function showResult(resultText, resultVoice) {
  speakerEl.textContent = "K·∫øt qu·∫£";
  clearChoices();

  // üîä Ph√°t voice k·∫øt qu·∫£ (n·∫øu c√≥)
if (voiceEnabled && resultVoice) {
  // L·∫•y t√™n file cu·ªëi c√πng (vd: result2A.mp3)
  const file = resultVoice.split("/").pop();

  // N·∫øu t·∫Øt voice th√¨ th√¥i, n·∫øu b·∫≠t th√¨ l·∫•y ƒë√∫ng folder hi·ªán t·∫°i
  voice.pause();
  voice.src = voiceFolder + file;
  voice.currentTime = 0;

  voice.play().catch(()=>{});
}

  typeText(resultText, () => {
    nextBtn.style.display = "inline-block";
  });
}

// Advance to next scene or ending calculation
function nextScene() {
  nextBtn.style.display = "none";
  idx++;
  if (idx < scenes.length - 4) { // scenes 0..10 are intro+10 situations; endings are last 4
    showScene();
  } else if (idx === 11) {
    // after finishing scene 11 (index 10?), ensure mapping: scenes[0]..scenes[10] are first 11.
    // Our scenes array: index 0..10 are intro+10, indexes 11..14 are endings.
    // We advanced idx and now if idx==11 we should compute ending index to jump to endings array index 11..14
    computeAndShowEnding();
  } else {
    // Should not reach here directly; fallback
    showScene();
  }
}

function computeAndShowEnding() {
  // Determine ending:
  // Condition: best if B === 10 (all balanced)
  // near best if B between 7..9
  // else compare A vs C: whichever greater determines ending
  // Map: ending indices in scenes array are 11..14 (0-based)
  let endingIndex = 14; // default worst (scene 15)
  const totalSituations = 10; // scenes 1..10 correspond to types counted
  if (B === totalSituations) {
    endingIndex = 11; // scene12
  } else if (B >= 7) {
    endingIndex = 12; // scene13
  } else {
    if (A > C) endingIndex = 13; // scene14 (too democratic)
    else endingIndex = 14; // scene15 (authoritarian)
  }
  idx = endingIndex;
  showScene();
}

// UI events
nextBtn.onclick = () => {
  playClick();
  // If we are before situations end, advance; else if at last situation, compute ending
  // Determine current index: if current scene had choices and user clicked next, move to next scene index
  // For flow, we simply increment and handle in nextScene
  // But need mapping: count of scenes: 0..10 are content; after user clicked through last, call computeEnding
  // Use nextScene function
  // However, careful: if idx points to one of intro or situation scenes, just increment
  // We'll use:
  // If idx < 10 -> idx++ and showScene; if idx === 10 -> compute ending next
  if (idx < 10) {
    idx++;
    showScene();
  } else if (idx === 10) {
    computeAndShowEnding();
  } else {
    // inside ending area, do nothing
  }
};

startBtn.onclick = async () => {
  started = true;
  startBtn.style.display = "none";
  // try to play bg music and voice
  try { bgMusic.volume = 0.45; await bgMusic.play(); } catch(e){}
  try { await playVoice(scenes[0].voice); } catch(e){}
  // show first scene (intro at idx 0)
  idx = 0;
  A = B = C = 0;
  restartBtn.style.display = "none";
  showScene();
};

restartBtn.onclick = () => {
  playClick();
  idx = 0;
  A = B = C = 0;
  restartBtn.style.display = "none";
  // reset background to scene1
  showScene();
};

musicToggle.onclick = () => {
  if (bgMusic.paused) {
    bgMusic.play().catch(()=>{});
    musicToggle.textContent = "T·∫Øt nh·∫°c";
  } else {
    bgMusic.pause();
    musicToggle.textContent = "B·∫≠t nh·∫°c";
  }
};

voiceToggle.onclick = () => {
  voiceEnabled = !voiceEnabled;

  if (voiceEnabled) {
    voiceToggle.textContent = "T·∫Øt gi·ªçng tho·∫°i";
  } else {
    voice.pause();
    voiceToggle.textContent = "B·∫≠t gi·ªçng tho·∫°i";
  }
};

// Allow clicking on choice area to focus
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && startBtn.style.display === "none") {
    // If choices visible, do nothing; else if next visible, trigger next
    if (nextBtn.style.display !== "none") nextBtn.click();
  }
});

// Safety: stop voice when moving scenes
voice.addEventListener("ended", ()=>{ /* nothing */ });

// Initialize background if images exist
bgEl = document.getElementById("background");
bgEl.style.backgroundImage = `url('${scenes[0].bg}')`;
</script>
</body>
</html>
